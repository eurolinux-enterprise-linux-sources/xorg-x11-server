From 62b9fa5973d71f3525af29f04f03e05bbaf196e6 Mon Sep 17 00:00:00 2001
From: Adam Jackson <ajax@redhat.com>
Date: Mon, 27 Jun 2011 12:42:28 -0400
Subject: [PATCH 05/15] Enable PAM support

Signed-off-by: Adam Jackson <ajax@redhat.com>
---
 configure.ac       |    2 ++
 hw/dmx/Makefile.am |    1 +
 os/utils.c         |    1 +
 3 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/configure.ac b/configure.ac
index 3808542..32571e2 100644
--- a/configure.ac
+++ b/configure.ac
@@ -307,6 +307,8 @@ AC_CHECK_HEADER([execinfo.h],[
     ])]
 )
 
+SYS_LIBS="-lpam_misc -lpam"
+
 dnl ---------------------------------------------------------------------------
 dnl Bus options and CPU capabilities.  Replaces logic in
 dnl hw/xfree86/os-support/bus/Makefile.am, among others.
diff --git a/hw/dmx/Makefile.am b/hw/dmx/Makefile.am
index fb727e6..ff76806 100644
--- a/hw/dmx/Makefile.am
+++ b/hw/dmx/Makefile.am
@@ -78,6 +78,7 @@ Xdmx_SOURCES = dmx.c \
 XDMX_LIBS = \
 	$(GLX_LIBS) \
 	@XDMX_LIBS@ \
+	-lpam_misc -lpam \
         input/libdmxinput.a \
         config/libdmxconfig.a
 
diff --git a/os/utils.c b/os/utils.c
index d902523..86730c5 100644
--- a/os/utils.c
+++ b/os/utils.c
@@ -1838,6 +1838,7 @@ CheckUserParameters(int argc, char **argv, char **envp)
  * usually only done for setuid servers (uid != euid).
  */
 
+#define USE_PAM 1
 #ifdef USE_PAM
 #include <security/pam_appl.h>
 #include <security/pam_misc.h>
-- 
1.7.7.6

